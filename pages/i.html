
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview</title>
    <style>
        body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    position: relative;
}

.bg-video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: -1;
}

.container {
    text-align: center;
    width: 100%;
    max-width: 400px;
    background: transparent;
    border-radius: 10px;
    padding: 20px;
}

img {
    width: 80px;
    margin-bottom: 20px;
}
.question
{
    margin-top: -2rem;
    font-size: 1rem;
    /* margin-bottom: 20px; */
    color: #fff;
}
h1 {
    margin-top: -2rem;
    font-size: 2rem;
    /* margin-bottom: 20px; */
    color: #fff;
}
p{
    margin-top: -2rem;
    font-size: small;
    color:#fff
}

h1 span {
    color: #ff79c6;
}

.input-box {
    position: relative;
    /* width: 320px; */
    background: rgba(50, 50, 50, 0.8);
    border-radius: 30px;
    display: flex;
    align-items: center;
    padding: 10px 15px;
    border: 1px solid #444;
}

/* Input Field */
.input-box input {
    width: 100%;
    background: transparent;
    border: none;
    outline: none;
    font-size: 16px;
    color: white;
}

/* Placeholder Text Color */
.input-box input::placeholder {
    color: #bbb;
}

/* Microphone Button */
.mic-button {
    color: #fff;
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
    position: absolute;
    right: 15px;
}

/* Microphone Icon */
.mic-button svg {
    width: 24px;
    height: 24px;
    fill: #ff00ff;
    transition: 0.3s;
}

/* Glow Effect on Hover */
.mic-button:hover svg {
    fill: #ff00ff;
    filter: drop-shadow(0 0 5px #ff00ff);
}

.main{

    height: 15rem;
    width: 15rem;
    
}
@media (max-width: 600px) {
    body {
        margin: auto;
    }

    .container {
        margin-top: 20rem;
        margin: 5rem;
        width: 100%;
        max-width: 20rem;
    }

    h1 {
        font-size: 2rem;
    }

    input {
        font-size: 0.9rem;
        padding: 8px;
    }

    button {
        font-size: 0.9rem;
        padding: 8px;
    }

    .checkbox {
        font-size: 0.8rem;
    }

    .signup {
        font-size: 0.8rem;
    }

    .img {
        position: absolute;
        top: 1rem;
        right: 2rem;
        width: 5rem;
        margin-bottom: 15px;
    }

    h1 span {
        display: block;
    }
} 
    </style>
</head>
<body>
    <img src="bg.gif" class="bg-video" />
    <img src="logoo.png" class="img" alt="Shakti AI Logo">
    <div class="container">
        <input type="text" id="user_id" value="{{ user_id }}" hidden>
        
        <h1>Hi<span> This is Shakti </span></h1>
        <div class=""> 
            <img id="mainImage" src="main.gif" class="main" alt="Shakti AI Logo">
        </div>
        <h6 id="question" class="question"></h6>

        <div class="input-box">
            <input type="text" id="textContent" placeholder="Type Here">
            <button class="mic-button" onclick="activeMic()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12 2a3 3 0 0 1 3 3v7a3 3 0 0 1-6 0V5a3 3 0 0 1 3-3zM5 10a1 1 0 1 1 2 0v2a5 5 0 0 0 10 0v-2a1 1 0 1 1 2 0v2a7 7 0 0 1-6 6.93V21a1 1 0 1 1-2 0v-2.07A7 7 0 0 1 5 12v-2z"/>
                </svg>
            </button>
        </div> 
    </div>    
    
    <script>

        function speakText(text,lang) {
            url = 'https://translate.google.com/translate_tts?ie=UTF-8&tl=' + lang + '&q=' + encodeURIComponent(text);
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            speechSynthesis.speak(utterance);
            const audio = new Audio(url);
            audio.play();
        }
        
        document.addEventListener("DOMContentLoaded", function () {
            const greeting = " Hi, I am Shakti , your  interview trainer! Please click on mic button to start speaking";
            document.getElementById('question').innerHTML = greeting;
            localStorage.clear();
            speakText(greeting, 'en-US');
            setTimeout(restoreOriginalImage, 2000);
        });

        // Initialize speech recognition
    let recognition;
    let isListening = false;
    let recordedText = "";

    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'en-US'; // Change to 'mr-IN' for Marathi
        recognition.interimResults = false;
        recognition.continuous = false;

        recognition.onstart = () => {
            console.log('Voice recognition started. Speak into the microphone.');
        };

        recognition.onresult = (event) => {
            recordedText = event.results[0][0].transcript;
            document.querySelector('.input-box input').value = recordedText;
            console.log('Speech recognized:', recordedText);
        };

        recognition.onerror = (event) => {
            console.error('Recognition error:', event.error);
        };

        recognition.onend = () => {
            isListening = false;
            console.log('Voice recognition stopped.');
        };
    } else {
        alert('Speech Recognition API is not supported in this browser.');
    }

    // Activate microphone
    function activeMic() {
        if (recognition && !isListening) {
            isListening = true;
            recordedText = "";
            recognition.start();
            recognition.onstart = () => {
    console.log('Voice recognition started. Speak into the microphone.');
};
        } else {
            console.log('Microphone is already active or not supported.');
        }
    }

    // Deactivate microphone
    function deactiveMic() {
        if (recognition && isListening) {
            recognition.stop();
            isListening = false;
        }

        const inputText = recordedText || document.querySelector('.input-box input').value;
        if (inputText.trim()) {
            console.log('Recorded text to send:', inputText);
        } else {
            console.log('No response to submit.');
        }
    }
        function changeImage(newImage) {
            const img = document.getElementById('mainImage');
            if (img) {
                if (!img.dataset.originalSrc) {
                    img.dataset.originalSrc = img.src;
                }
                img.src = "/" + newImage;
            }
        }

        function restoreOriginalImage() {
            const img = document.getElementById('mainImage');
            if (img && img.dataset.originalSrc) {
                img.src = img.dataset.originalSrc;
            }
        }

//     document.getElementById('textContent').addEventListener('change', async function() {
//     const inputText =document.getElementById('textContent').value;
//     if (inputText.trim()) {
//         console.log('Recorded text to send:', inputText);
//         const url = "http://139.59.42.156:11434/api/generate";
//         const headers = {
//             "Content-Type": "application/json"
//         };
//         const data = {
//             "model": "gemma:2b",
//             "prompt": inputText,
//             "stream": false
//         };
//         const response = await fetch(url, {
//             method: "POST",
//             headers: headers,
//             body: JSON.stringify(data)
//         });
//         console.log(await response)
//         if (response.ok) {
//             const responseData = await response.json();
//             const answer = responseData.response;
//             console.log(answer);
//             document.getElementById('question').innerText = answer;
//             speakText(answer, 'hi-IN');
//             changeImage('loading.gif');
//             setTimeout(restoreOriginalImage, 2000);
//         } else {
//             console.error("Error fetching response from the API.");
//         }
// }
// });
document.getElementById('textContent').addEventListener('change', async function() {
    const inputText = document.getElementById('textContent').value;
//     if (inputText.trim()) {
//         console.log('Recorded text to send:', inputText);

//         // Retrieve chat history from localStorage
//         let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];

//         // Add the new user input to the chat history
//         chatHistory.push({ role: 'user', message: inputText });
// console.log(chatHistory);

        // Prepare the data to be sent to the API, including the chat history
        const url = "http://139.59.42.156:11434/api/generate";
        const headers = {
            "Content-Type": "application/json"
        };
        const data = {
            "model": "gemma:2b",
            "prompt": inputText,
            "chat_history": chatHistory,  // Include chat history
            "stream": false
        };

        try {
            const response = await fetch(url, {
                method: "POST",
                headers: headers,
                body: JSON.stringify(data)
            });

            console.log(await response);

            if (response.ok) {
                const responseData = await response.json();
                const answer = responseData.response;

                console.log(answer);

                // Display the answer and update the chat history
                chatHistory.push({ role: 'model', message: answer });

                // Save the updated chat history to localStorage
                localStorage.setItem('chatHistory', JSON.stringify(chatHistory));

                document.getElementById('question').innerText = answer;
                speakText(answer, 'hi-IN');
                changeImage('loading.gif');
                setTimeout(restoreOriginalImage, 2000);
            } else {
                console.error("Error fetching response from the API.");
            }
        } catch (error) {
            console.error('Error in the fetch operation:', error);
        }
    // }
});
    </script>
</body>
</html>

